<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>San Fernando Valley Business Directory</title>
    <meta name="description" content="Find local businesses in the San Fernando Valley. Browse by category or neighborhood.">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="nav">
        <div class="container">
            <div class="nav-content">
                <a href="#" class="nav-brand">San Fernando Valley Directory</a>
                
                <div class="nav-links">
                    <a href="#categories" class="nav-link">Categories</a>
                    <a href="#neighborhoods" class="nav-link">Neighborhoods</a>
                    <a href="#search" class="nav-link">Search</a>
                </div>
                
                <button type="button" class="mobile-menu-btn" aria-label="Open mobile menu">
                    <svg width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                </button>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <div class="hero-content">
                <h1>San Fernando Valley</h1>
                <p>Discover restaurants, services, and the best local businesses in the San Fernando Valley.</p>
                
                <!-- Quick Search -->
                <div class="search-container" id="search">
                    <div class="search-form-wrapper">
                        <form class="search-form" id="searchForm">
                            <div class="search-grid">
                                <div class="form-group">
                                    <label for="category" class="form-label">Category</label>
                                    <select id="category" name="category" class="form-select">
                                        <option value="">All Categories</option>
                                        <option value="restaurants">Restaurants</option>
                                        <option value="gyms">Gyms & Fitness</option>
                                        <option value="auto">Auto Services</option>
                                        <option value="beauty">Beauty & Personal Care</option>
                                        <option value="home-services">Home Services</option>
                                        <option value="shopping">Shopping</option>
                                        <option value="bars">Bars & Nightlife</option>
                                        <option value="health">Health & Medical</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="neighborhood" class="form-label">Neighborhood</label>
                                    <select id="neighborhood" name="neighborhood" class="form-select">
                                        <option value="">All Neighborhoods</option>
                                        <option value="sherman-oaks">Sherman Oaks</option>
                                        <option value="van-nuys">Van Nuys</option>
                                        <option value="encino">Encino</option>
                                        <option value="studio-city">Studio City</option>
                                        <option value="north-hollywood">North Hollywood</option>
                                        <option value="woodland-hills">Woodland Hills</option>
                                        <option value="burbank">Burbank</option>
                                        <option value="glendale">Glendale</option>
                                    </select>
                                </div>
                            </div>
                            <button type="submit" class="search-btn">
                                Search Businesses
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Results Section -->
    <section class="results-section" id="resultsSection">
        <div class="container">
            <div class="results-wrapper">
                <h2 class="results-title">Search Results</h2>
                <div id="resultsContainer"></div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Categories Section -->
            <section id="categories" class="section">
                <div class="section-header">
                    <h2 class="section-title">Browse by Category</h2>
                    <p class="section-description">Find the businesses you need by browsing our categories</p>
                </div>
                
                <div class="categories-grid">
                    <div class="category-card" data-category="restaurants">
                        <div class="category-content">
                            <div class="category-icon restaurants">
                                <svg width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                                </svg>
                            </div>
                            <div class="category-info">
                                <h3>Restaurants</h3>
                                <p>Dining establishments</p>
                            </div>
                        </div>
                    </div>

                    <div class="category-card" data-category="gyms">
                        <div class="category-content">
                            <div class="category-icon gyms">
                                <svg width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                                </svg>
                            </div>
                            <div class="category-info">
                                <h3>Gyms & Fitness</h3>
                                <p>Fitness centers</p>
                            </div>
                        </div>
                    </div>

                    <div class="category-card" data-category="auto">
                        <div class="category-content">
                            <div class="category-icon auto">
                                <svg width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 9.172V5L8 4z" />
                                </svg>
                            </div>
                            <div class="category-info">
                                <h3>Auto Services</h3>
                                <p>Vehicle maintenance</p>
                            </div>
                        </div>
                    </div>

                    <div class="category-card" data-category="beauty">
                        <div class="category-content">
                            <div class="category-icon beauty">
                                <svg width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                                </svg>
                            </div>
                            <div class="category-info">
                                <h3>Beauty & Personal Care</h3>
                                <p>Salons and services</p>
                            </div>
                        </div>
                    </div>

                    <div class="category-card" data-category="home-services">
                        <div class="category-content">
                            <div class="category-icon home-services">
                                <svg width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z" />
                                </svg>
                            </div>
                            <div class="category-info">
                                <h3>Home Services</h3>
                                <p>Contractors and repair</p>
                            </div>
                        </div>
                    </div>

                    <div class="category-card" data-category="shopping">
                        <div class="category-content">
                            <div class="category-icon shopping">
                                <svg width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                                </svg>
                            </div>
                            <div class="category-info">
                                <h3>Shopping</h3>
                                <p>Retail stores</p>
                            </div>
                        </div>
                    </div>

                    <div class="category-card" data-category="health">
                        <div class="category-content">
                            <div class="category-icon health">
                                <svg width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                                </svg>
                            </div>
                            <div class="category-info">
                                <h3>Health & Medical</h3>
                                <p>Medical services</p>
                            </div>
                        </div>
                    </div>

                    <div class="category-card" data-category="entertainment">
                        <div class="category-content">
                            <div class="category-icon entertainment">
                                <svg width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1.01M15 10h1.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            </div>
                            <div class="category-info">
                                <h3>Entertainment</h3>
                                <p>Movies and venues</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Neighborhoods Section -->
            <section id="neighborhoods" class="neighborhoods-section">
                <div class="section-header">
                    <h2 class="section-title">Browse by Neighborhood</h2>
                    <p class="section-description">Explore businesses in your area</p>
                </div>
                
                <div class="neighborhoods-grid">
                    <button class="neighborhood-link" data-neighborhood="sherman-oaks">
                        <span>Sherman Oaks</span>
                    </button>
                    <button class="neighborhood-link" data-neighborhood="van-nuys">
                        <span>Van Nuys</span>
                    </button>
                    <button class="neighborhood-link" data-neighborhood="encino">
                        <span>Encino</span>
                    </button>
                    <button class="neighborhood-link" data-neighborhood="studio-city">
                        <span>Studio City</span>
                    </button>
                    <button class="neighborhood-link" data-neighborhood="north-hollywood">
                        <span>North Hollywood</span>
                    </button>
                    <button class="neighborhood-link" data-neighborhood="woodland-hills">
                        <span>Woodland Hills</span>
                    </button>
                    <button class="neighborhood-link" data-neighborhood="burbank">
                        <span>Burbank</span>
                    </button>
                    <button class="neighborhood-link" data-neighborhood="glendale">
                        <span>Glendale</span>
                    </button>
                    <button class="neighborhood-link" data-neighborhood="northridge">
                        <span>Northridge</span>
                    </button>
                    <button class="neighborhood-link" data-neighborhood="canoga-park">
                        <span>Canoga Park</span>
                    </button>
                    <button class="neighborhood-link" data-neighborhood="chatsworth">
                        <span>Chatsworth</span>
                    </button>
                    <button class="neighborhood-link" data-neighborhood="reseda">
                        <span>Reseda</span>
                    </button>
                </div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <p>&copy; 2025 San Fernando Valley Directory. Find local businesses in the SFV.</p>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Supabase configuration
        const SUPABASE_URL = 'https://rnkbkjnxnumqtctetyvz.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJua2Jram54bnVtcXRjdGV0eXZ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY2NTQ0NjUsImV4cCI6MjA3MjIzMDQ2NX0.0I_IhSSq4g2kh_A55uDmg7TcieWaonMK33UQPc-lC14';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Search form handler
        document.getElementById('searchForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const category = document.getElementById('category').value;
            const neighborhood = document.getElementById('neighborhood').value;
            await searchBusinesses(category, neighborhood);
        });

        // Category card handlers
        document.querySelectorAll('.category-card').forEach(card => {
            card.addEventListener('click', async function(e) {
                e.preventDefault();
                const category = this.getAttribute('data-category');
                document.getElementById('category').value = category;
                document.getElementById('neighborhood').value = '';
                await searchBusinesses(category, '');
                document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
            });
        });

        // Neighborhood link handlers
        document.querySelectorAll('.neighborhood-link').forEach(link => {
            link.addEventListener('click', async function(e) {
                e.preventDefault();
                const neighborhood = this.getAttribute('data-neighborhood');
                document.getElementById('category').value = '';
                document.getElementById('neighborhood').value = neighborhood;
                await searchBusinesses('', neighborhood);
                document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
            });
        });

        async function searchBusinesses(categorySlug, neighborhoodSlug) {
            const resultsSection = document.getElementById('resultsSection');
            const resultsContainer = document.getElementById('resultsContainer');
            
            resultsSection.style.display = 'block';
            resultsContainer.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <span class="loading-text">Searching businesses...</span>
                </div>
            `;
            
            try {
                let query = supabase
                    .from('businesses')
                    .select(`
                        *,
                        categories (name, slug),
                        business_tags (
                            tags (name, slug, tag_type)
                        )
                    `)
                    .eq('status', 'active');
                
                const { data: businesses, error } = await query;
                
                if (error) throw error;
                
                let filteredBusinesses = businesses || [];
                
                if (categorySlug) {
                    filteredBusinesses = filteredBusinesses.filter(business => 
                        business.categories && business.categories.slug === categorySlug
                    );
                }
                
                if (neighborhoodSlug) {
                    filteredBusinesses = filteredBusinesses.filter(business => 
                        business.business_tags && business.business_tags.some(bt => 
                            bt.tags && bt.tags.slug === neighborhoodSlug
                        )
                    );
                }
                
                displayResults(filteredBusinesses, categorySlug, neighborhoodSlug);
                
            } catch (error) {
                console.error('Error:', error);
                resultsContainer.innerHTML = `
                    <div class="error-message">
                        <div>Error loading results. Please try again.</div>
                    </div>
                `;
            }
        }

        function displayResults(businesses, categorySlug, neighborhoodSlug) {
            const resultsContainer = document.getElementById('resultsContainer');
            
            if (businesses.length === 0) {
                resultsContainer.innerHTML = `
                    <div class="no-results">
                        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        <h3>No businesses found</h3>
                        <p>Try a different category or neighborhood.</p>
                    </div>
                `;
                return;
            }
            
            const businessCards = businesses.map(business => {
                const tags = business.business_tags
                    ?.map(bt => bt.tags)
                    .filter(tag => tag)
                    .map(tag => `<span class="tag">${tag.name}</span>`)
                    .join(' ') || '';
                
                return `
                    <div class="business-card">
                        <h3 class="business-name">${business.name}</h3>
                        <p class="business-address">${business.address}</p>
                        ${business.phone ? `<p class="business-phone">📞 <a href="tel:${business.phone}">${business.phone}</a></p>` : ''}
                        ${business.website ? `<p class="business-website"><a href="${business.website}" target="_blank">Visit Website →</a></p>` : ''}
                        ${tags ? `<div class="business-tags">${tags}</div>` : ''}
                    </div>
                `;
            }).join('');
            
            resultsContainer.innerHTML = `
                <div class="results-summary">
                    <p>Found ${businesses.length} business${businesses.length !== 1 ? 'es' : ''}</p>
                </div>
                <div class="business-cards">
                    ${businessCards}
                </div>
            `;
        }

        // Smooth scrolling for navigation
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth' });
                }
            });
        });
    </script>
</body>
</html>